sudo: required

services:
  - docker

env:
  global:
    - PACKAGE="apache-tomcat"
    - VERSION="7.0.68"
    - RELEASE="1"
    - DIST="el7"
    - DIR="/data"
    - CONTAINER="centos:7"
    
install:
# Build the RPM(s).
- docker run -v $(pwd):${DIR} ${CONTAINER} /bin/sh ${DIR}/scripts/build.sh -p ${PACKAGE} -v ${VERSION} -r ${RELEASE} -d ${DIST}

# Test the installation of the RPM.
# - docker run -v $(pwd):${DIR} ${CONTAINER} /bin/sh ${DIR}/scripts/test.sh -p ${PACKAGE} -v ${VERSION} -r ${RELEASE} -d ${DIST}

# Create a repository. (Can be used to publish to i.e. Amazon S3)
- docker run -v $(pwd):${DIR} ${CONTAINER} /bin/sh ${DIR}/scripts/createrepo.sh

script:
  # Run all tests in the "tests" directory using bats.
  - bats tests
  # Publish to Amazon S3.
  - docker run -v $(pwd):${DIR} ${CONTAINER} /bin/sh ${DIR}/scripts/publish-s3.sh -r eu-west-1 -b apache-tomcat7.el7 -k ${S3KEY} -s ${S3SECRET} -d /data/repository/

notifications:
  email: false
